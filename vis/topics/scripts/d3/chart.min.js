var width=0,height=0,topics;var yearOffset=2008;function initDrawChart(b){this.width=$("#flow_viz").width();this.height=$("#path_viz").height();this.topics=b;draw()}function draw(){var c={top:20,right:0,bottom:0,left:50};width=width-c.left-c.right-0;height=height-c.top-c.bottom-40;var b=d3.scale.linear().domain([yearOffset,yearOffset+topics[0].periods.length-0.75]).range([c.left,width]);drawChart(topics,b,"Topic_Probability","Topic","Units",width,height,c)}function drawChart(c,i,m,f,n,h,d,g){var p=d3.min(c),l=d3.max(c);var p=d3.min(c,function(q){return d3.min(q.periods,function(r){return r.weight})});l=d3.max(c,function(q){return d3.max(q.periods,function(r){return r.weight})});var e=d3.scale.linear().domain([p,l+0.03]).range([d,0]),b=d3.scale.category10().domain(c.map(function(q){return q.id}));var j=d3.select("#path_viz").append("svg:svg").attr("id","chart").attr("width",h+g.left+g.right).attr("height",d+g.top+g.bottom);var k=make_x_axis(i);j.append("g").attr("class","grid").attr("transform","translate(0,"+d+")").call(make_x_axis(i).tickSize(-d,0,0).tickFormat(""));j.append("g").attr("class","x axis").attr("transform","translate(0,"+d+")").call(k).append("text").attr("x",h/2).attr("y",20).attr("dy","1.5em").style("text-anchor","end").text("Trend of Topics");y_axis=make_y_axis(e);j.append("g").attr("class","grid").attr("transform","translate("+g.left+",0)").call(make_y_axis(e).tickSize(-(h-g.left),0,0).tickFormat(""));j.append("g").attr("class","y axis").attr("transform","translate("+g.left+",10)").call(y_axis);var o=d3.svg.line().x(function(r,q){return i(yearOffset+q)}).y(function(q){return e(q.weight)}).interpolate("cardinal");star=j.selectAll(".topic").data(c).enter().append("svg:g").attr("class","topic");star.append("svg:path").attr("d",function(q){return o(q.periods)}).attr("id",function(q){return q.id}).attr("class","topic").attr("type","budget").style("stroke",function(q){return b(q.id)});c.forEach(function(r,q){addPoints(r.id,star,i,e,c[q],f,n,b(r.id))})}function addPoints(g,h,c,f,e,i,b,d){h.selectAll("data-point").data(e.periods).enter().append("svg:circle").attr("class","data-point").style("opacity",1).style("stroke",d).attr("cx",function(k,j){return c(yearOffset+j)}).attr("cy",function(j){return f(j.weight)}).attr("r",function(){return 4});$("svg circle").tipsy({gravity:"w",html:!0,title:function(){a=this.__data__.weight;var j=d3.round(a,3);return"Topic"+e.id+"<br/>"+i+": "+j+" %"}})}function selectActors(b){null!=b&&(selected=d3.map(),b.forEach(function(c){selected.set(c,1)}),drawAllCharts())}function chartChange(b){s_star=b;initStarpaths()}function toggleTrends(){showTrends=$("#trend_checkbox").is(":checked")?!0:!1;drawAllCharts()}function make_x_axis(b){return d3.svg.axis().scale(b).orient("bottom").ticks(6).tickFormat(d3.format("0000"))}function make_y_axis(b){return d3.svg.axis().scale(b).orient("left").ticks(10)};