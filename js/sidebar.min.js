var w=$("#sidebar").width();var svg_height=$("#sidebar").height();var h=svg_height;var trans=-20;var ratio=3;console.log(h);var oR=0;var nTop=0;var svgContainer=d3.select("#mainBubble").style("height",h+"px").style("width",w+"px");var svg=d3.select("#mainBubble").append("svg").attr("class","mainBubbleSVG").attr("width",w).attr("height",h).on("mouseleave",function(){return resetBubbles()});var mainNote=svg.append("text").attr("id","bubbleItemNote").attr("x",0).attr("y",h-15).attr("font-size",12).attr("dominant-baseline","middle").attr("alignment-baseline","middle").style("fill","#888888").text(function(a){return"Home"});d3.json("data/sidebar.json",function(e,d){console.log(e);var c=svg.selectAll(".topBubble").data(d.children).enter().append("g").attr("id",function(j,g){return"topBubbleAndText_"+g});console.log(d);nTop=d.children.length;oR=w/5;svgContainer.style("width",w+"px");var f=d3.scale.category10();c.append("circle").attr("class","topBubble").attr("id",function(j,g){return"topBubble"+g}).attr("r",function(g){return oR}).attr("cx",function(j,g){return w/2}).attr("cy",function(j,g){return oR*(3*(1+g)-1)}).style("fill",function(j,g){return f(g)}).style("opacity",0.3).on("click",function(j,g){window.open(j.address)}).on("mouseover",function(k,j){var g="";if(k.description==null||k.description==""){g=k.address}else{g=k.description}d3.select("#bubbleItemNote").text(g);return activateBubble(k,j)}).attr("transform","translate(0, "+trans+" )");c.append("text").attr("class","topBubbleText").attr("x",function(j,g){return w/2}).attr("y",function(j,g){return oR*(3*(1+g)-1)}).style("fill",function(j,g){return f(g)}).attr("font-size",30).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("alignment-baseline","middle").attr("cursor","pointer").text(function(g){return g.name}).attr("transform","translate(0, "+trans+" )").on("click",function(j,g){window.open(j.address)}).on("mouseover",function(k,j){var g="";if(k.description==null||k.description==""){g=k.address}else{g=k.description}d3.select("#bubbleItemNote").text(g);return activateBubble(k,j)});for(var b=0;b<nTop;b++){var a=svg.selectAll(".childBubble"+b).data(d.children[b].children).enter().append("g");a.append("circle").attr("transform","translate(0, "+trans+" )").attr("class","childBubble"+b).attr("id",function(j,g){return"childBubble_"+b+"sub_"+g}).attr("r",function(g){return oR/ratio}).attr("cx",function(j,g){return w/2+oR*(3/2)*Math.sin((g-1)*45/180*Math.PI)}).attr("cy",function(j,g){return oR*(3*(1+b)-1)+oR*(3/2)*Math.cos((g-1)*45/180*Math.PI)}).attr("cursor","pointer").style("opacity",0.5).style("fill","#eee").on("click",function(j,g){window.open(j.address)}).on("mouseover",function(k,j){var g="";if(k.note==null||k.note==""){g=k.address}else{g=k.note}d3.select("#bubbleItemNote").text(g)}).append("svg:title").text(function(g){return g.address});a.append("text").attr("transform","translate(0, "+trans+" )").attr("class","childBubbleText"+b).attr("x",function(j,g){return w/2+oR*(3/2)*Math.sin((g-1)*45/180*Math.PI)}).attr("y",function(j,g){return oR*(3*(1+b)-1)+oR*(3/2)*Math.cos((g-1)*45/180*Math.PI)}).style("opacity",0.5).attr("text-anchor","middle").style("fill",function(j,g){return f(b)}).attr("font-size",6).attr("cursor","pointer").attr("dominant-baseline","middle").attr("alignment-baseline","middle").text(function(g){return g.name}).on("click",function(j,g){window.open(j.address)})}});resetBubbles=function(){w=$("#sidebar").width();h=svg_height;svgContainer.style("height",h+"px");mainNote.attr("y",h-15);svg.attr("width",w);svg.attr("height",h);d3.select("#bubbleItemNote").text("Home");var b=svg.transition().duration(650);b.selectAll(".topBubble").attr("transform","translate(0, "+trans+" )").attr("r",function(c){return oR}).attr("cx",function(e,c){return w/2}).attr("cy",function(e,c){return oR*(3*(1+c)-1)});b.selectAll(".topBubbleText").attr("transform","translate(0, "+trans+" )").attr("font-size",30).attr("x",function(e,c){return w/2}).attr("y",function(e,c){return oR*(3*(1+c)-1)});for(var a=0;a<nTop;a++){b.selectAll(".childBubbleText"+a).attr("transform","translate(0, "+trans+" )").attr("x",function(e,c){return w/2+oR*(3/2)*Math.sin((c-1)*45/180*Math.PI)}).attr("y",function(e,c){return oR*(3*(1+a)-1)+oR*(3/2)*Math.cos((c-1)*45/180*Math.PI)}).attr("font-size",6).style("opacity",0.5);b.selectAll(".childBubble"+a).attr("transform","translate(0, "+trans+" )").attr("r",function(c){return oR/3}).style("opacity",0.5).attr("cx",function(e,c){return w/2+oR*(3/2)*Math.sin((c-1)*45/180*Math.PI)}).attr("cy",function(e,c){return oR*(3*(1+a)-1)+oR*(3/2)*Math.cos((c-1)*45/180*Math.PI)})}};function activateBubble(g,f){console.log("In activateBubble");var e=svg.transition().duration(d3.event.altKey?7500:350);e.selectAll(".topBubble").attr("cy",function(j,i){if(f==i){return oR*(3*(1+i)-1)}else{if(i<f){return oR*0.6*(3*(1+i)-1)}else{return oR*(nTop*3+1)-oR*0.6*(3*(nTop-i)-1)}}}).attr("r",function(j,i){if(f==i){return oR*1.3}else{return oR*0.8}});e.selectAll(".topBubbleText").attr("y",function(j,i){if(f==i){return oR*(3*(1+i)-1)}else{if(i<f){return oR*0.6*(3*(1+i)-1)}else{return oR*(nTop*3+1)-oR*0.6*(3*(nTop-i)-1)}}}).attr("font-size",function(j,i){if(f==i){return 30*1.5}else{return 30*0.6}});var a=-1;var c=f;for(var b=0;b<nTop;b++){a=1;if(b<nTop/2){a=1}e.selectAll(".childBubbleText"+b).attr("x",function(k,j){if(c==b){return w/2+(1.3*oR)*(3/2)*Math.sin((j-1)*45/180*Math.PI)}return w/2+a*oR*(1+1/ratio+1/ratio/2)*Math.sin((j-1)*45/180*Math.PI)}).attr("y",function(k,j){if(c==b){return oR*(3*(1+b)-1)+(oR*1.3)*(3/2)*Math.cos((j-1)*45/180*Math.PI)}return oR*(3*(1+b)-1)-0.6*oR*(b-1)+a*oR*(1+1/ratio+1/ratio/2)*Math.cos((j-1)*45/180*Math.PI)+oR}).attr("font-size",function(){return(b==f)?12:0}).style("opacity",function(){return(b==f)?1:0});e.selectAll(".childBubble"+b).attr("cx",function(k,j){if(c==b){return w/2+(1.3*oR)*(3/2)*Math.sin((j-1)*45/180*Math.PI)}return w/2+a*oR*(1+1/ratio+1/ratio/2)*Math.sin((j-1)*45/180*Math.PI)}).attr("cy",function(k,j){if(c==b){return oR*(3*(1+b)-1)+(oR*1.3)*(3/2)*Math.cos((j-1)*45/180*Math.PI)}return oR*(3*(1+b)-1)-0.6*oR*(b-1)+a*oR*(1+1/ratio+1/ratio/2)*Math.cos((j-1)*45/180*Math.PI)+oR}).attr("r",function(){return(b==f)?(oR*0.55):0}).style("opacity",function(){return(b==f)?1:0})}}window.onresize=resetBubbles;